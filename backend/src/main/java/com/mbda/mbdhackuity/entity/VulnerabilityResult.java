package com.mbda.mbdhackuity.entity;

import jakarta.persistence.*;
import lombok.Data;
import org.hibernate.annotations.JdbcTypeCode;
import org.hibernate.type.SqlTypes;

import java.math.BigDecimal;
import java.time.LocalDateTime;

@Entity
@Table(name = "vulnerability_results")
@Data
public class VulnerabilityResult {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(name = "cve_id", length = 50)
    private String cveId;

    @Column(name = "asset_id")
    private Long assetId;

    @Column(name = "scan_name")
    private String scanName;

    @Column(name = "package_name")
    private String packageName;

    @Column(name = "package_version", length = 100)
    private String packageVersion;

    @Column(name = "cve_description", columnDefinition = "TEXT")
    private String cveDescription;

    @Column(length = 100)
    private String cwe;

    @Column(name = "cvss_version", length = 20)
    private String cvssVersion;

    @Column(name = "base_score", precision = 3, scale = 1)
    private BigDecimal baseScore;

    @Column(name = "base_severity", length = 20)
    private String baseSeverity;

    @Column(name = "vector_string", columnDefinition = "TEXT")
    private String vectorString;

    @Column(name = "affected_technologies", columnDefinition = "TEXT")
    private String affectedTechnologies;

    @Column(name = "exploit_poc_available")
    private Boolean exploitPocAvailable;

    @Column(name = "exploit_references", columnDefinition = "TEXT")
    private String exploitReferences;

    @Column(name = "published_date")
    private LocalDateTime publishedDate;

    @Column(name = "last_modified_date")
    private LocalDateTime lastModifiedDate;

    @Column(name = "match_confidence", precision = 3, scale = 2)
    private BigDecimal matchConfidence;

    @Column(name = "match_type", length = 50)
    private String matchType;

    @Column(name = "validity_status")
    private String validityStatus;

    // Champs pour modification CVSS
    @Column(name = "modified_score", precision = 3, scale = 1)
    private BigDecimal modifiedScore;

    @Column(name = "modified_vector", columnDefinition = "TEXT")
    private String modifiedVector;

    @Column(name = "modified_severity", length = 20)
    private String modifiedSeverity;

    @Column(name = "modified_by")
    private String modifiedBy;

    @Column(name = "modified_at")
    private LocalDateTime modifiedAt;


    // Commentaires
    @JdbcTypeCode(SqlTypes.JSON)
    @Column(name = "comments", columnDefinition = "jsonb")
    private String comments;

    // Analyst and Validator Comments
    @Column(name = "comments_analyst", columnDefinition = "TEXT")
    private String commentsAnalyst;

    @Column(name = "comments_validator", columnDefinition = "TEXT")
    private String commentsValidator;

    // Statut RSSI
    @Column(name = "rssi_status", length = 50)
    private String rssiStatus = "A traiter";

    // Statut Métier
    @Column(name = "metier_status", length = 50)
    private String metierStatus = "A traiter";

    @JdbcTypeCode(SqlTypes.JSON)
    @Column(name = "cve_references", columnDefinition = "jsonb")
    private String cveReferences;

    // Champs enrichis (compatibilité Cyberwatch)
    @Column(name = "epss_score", precision = 5, scale = 2)
    private BigDecimal epssScore;

    @Column(name = "exploit_level", length = 50)
    private String exploitLevel;

    @Column(name = "is_priority")
    private Boolean isPriority = false;

    @Column(name = "is_ignored")
    private Boolean isIgnored = false;

    @Column(name = "ignored_date")
    private LocalDateTime ignoredDate;

    @Column(name = "cisa_kev_date")
    private LocalDateTime cisaKevDate;

    @Column(name = "cert_fr_ale_date")
    private LocalDateTime certFrAleDate;

    @Column(name = "asset_groups", columnDefinition = "TEXT")
    private String assetGroups;

    @Column(name = "last_scan_date")
    private LocalDateTime lastScanDate;

    // Obsolescence detection
    @Column(name = "obsolescence_detected")
    private Boolean obsolescenceDetected = false;

    @Column(name = "obsolescence_info", columnDefinition = "TEXT")
    private String obsolescenceInfo;

    // Timestamps - commented out as columns do not exist in database
    // @Column(name = "created_at")
    // private LocalDateTime createdAt = LocalDateTime.now();

    // @Column(name = "updated_at")
    // private LocalDateTime updatedAt = LocalDateTime.now();
}